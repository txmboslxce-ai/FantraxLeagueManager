{% extends "admin/base.html" %}

{% block admin_content %}
<h1>{{ title }}</h1>

<!-- Create Cup Form -->
<div class="card mb-4">
    <div class="card-header">
        <h4>Create New Cup Competition</h4>
    </div>
    <div class="card-body">
        <form method="POST">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.name.label(class="form-label") }}
                {{ form.name(class="form-control") }}
                {% for error in form.name.errors %}
                    <span class="text-danger">{{ error }}</span>
                {% endfor %}
            </div>
            <div class="form-group mt-2">
                <div class="form-check">
                    {{ form.has_groups(class="form-check-input") }}
                    {{ form.has_groups.label(class="form-check-label") }}
                </div>
            </div>
            <div id="group-options" style="display: none;">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mt-2">
                            {{ form.num_groups.label(class="form-label") }}
                            {{ form.num_groups(class="form-control") }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mt-2">
                            {{ form.teams_per_group.label(class="form-label") }}
                            {{ form.teams_per_group(class="form-control") }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-3">
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>
    </div>
</div>

<!-- List of Existing Cups -->
<div class="card">
    <div class="card-header">
        <h4>Existing Cup Competitions</h4>
    </div>
    <div class="card-body">
        {% if cups %}
            <div class="list-group">
                {% for cup in cups %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-1">{{ cup.name }}</h5>
                            {% if cup.has_groups %}
                                <small class="text-muted">Group Stage Format ({{ cup.num_groups }} groups of {{ cup.teams_per_group }})</small>
                            {% else %}
                                <small class="text-muted">Traditional Knockout Format</small>
                            {% endif %}
                        </div>
                        <div class="d-flex gap-2">
                            {% if cup.has_groups %}
                                <a href="{{ url_for('admin.manage_cup_groups', cup_id=cup.id) }}" 
                                   class="btn btn-sm btn-outline-success">
                                    Manage Groups
                                </a>
                            {% endif %}
                            <a href="{{ url_for('admin.manage_cup_rounds', cup_id=cup.id) }}" 
                               class="btn btn-sm btn-outline-primary">
                                Manage Rounds
                            </a>
                            <form method="POST" action="{{ url_for('admin.delete_cup', cup_id=cup.id) }}" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-outline-danger" 
                                        onclick="return confirm('Are you sure you want to delete this cup competition? This will delete all rounds and matches.')">
                                    Delete
                                </button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">No cup competitions created yet.</p>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const hasGroupsCheckbox = document.getElementById('has_groups');
    const groupOptions = document.getElementById('group-options');
    
    function toggleGroupOptions() {
        if (hasGroupsCheckbox.checked) {
            groupOptions.style.display = 'block';
        } else {
            groupOptions.style.display = 'none';
        }
    }
    
    hasGroupsCheckbox.addEventListener('change', toggleGroupOptions);
    toggleGroupOptions(); // Set initial state
});
</script>
{% endblock %} 