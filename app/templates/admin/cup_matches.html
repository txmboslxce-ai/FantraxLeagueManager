{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>{{ title }}</h1>
    
    <!-- Matches Table -->
    <div class="card">
        <div class="card-header">
            <h2 class="h5 mb-0">Matches</h2>
        </div>
        <div class="card-body">
            {% if matches %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Match</th>
                                <th>Home Team</th>
                                <th>Away Team</th>
                                <th>First Leg</th>
                                <th>Second Leg</th>
                                <th>Aggregate</th>
                                <th>Winner</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for match in matches %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>
                                    <form method="POST" class="d-inline match-form" id="form-{{ match.id }}">
                                        <input type="hidden" name="match_id" value="{{ match.id }}">
                                        <select name="home_team_id" class="form-select form-select-sm team-select" data-match-id="{{ match.id }}" {% if match.first_leg_complete %}disabled{% endif %}>
                                            <option value="">Select Team</option>
                                            {% for team in teams %}
                                                <option value="{{ team.id }}" {% if match.home_team_id == team.id %}selected{% endif %}>
                                                    {{ team.name }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </form>
                                </td>
                                <td>
                                    <select name="away_team_id" form="form-{{ match.id }}" class="form-select form-select-sm team-select" data-match-id="{{ match.id }}" {% if match.first_leg_complete %}disabled{% endif %}>
                                        <option value="">Select Team</option>
                                        {% for team in teams %}
                                            <option value="{{ team.id }}" {% if match.away_team_id == team.id %}selected{% endif %}>
                                                {{ team.name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    {% if match.first_leg_complete %}
                                        <span class="badge {% if match.first_leg_home_score > match.first_leg_away_score %}bg-success{% elif match.first_leg_home_score < match.first_leg_away_score %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ "%.2f"|format(match.first_leg_home_score) }}
                                        </span>
                                        -
                                        <span class="badge {% if match.first_leg_away_score > match.first_leg_home_score %}bg-success{% elif match.first_leg_away_score < match.first_leg_home_score %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ "%.2f"|format(match.first_leg_away_score) }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if match.second_leg_complete %}
                                        <span class="badge {% if match.second_leg_home_score > match.second_leg_away_score %}bg-success{% elif match.second_leg_home_score < match.second_leg_away_score %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ "%.2f"|format(match.second_leg_home_score) }}
                                        </span>
                                        -
                                        <span class="badge {% if match.second_leg_away_score > match.second_leg_home_score %}bg-success{% elif match.second_leg_away_score < match.second_leg_home_score %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ "%.2f"|format(match.second_leg_away_score) }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if match.aggregate_home_score is not none %}
                                        <span class="badge {% if match.aggregate_home_score > match.aggregate_away_score %}bg-success{% elif match.aggregate_home_score < match.aggregate_away_score %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ "%.2f"|format(match.aggregate_home_score) }}
                                        </span>
                                        -
                                        <span class="badge {% if match.aggregate_away_score > match.aggregate_home_score %}bg-success{% elif match.aggregate_away_score < match.aggregate_home_score %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ "%.2f"|format(match.aggregate_away_score) }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if match.winner %}
                                        <span class="badge bg-success">{{ match.winner.name }}</span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if not match.first_leg_complete and not match.second_leg_complete %}
                                        <form method="POST" class="d-inline">
                                            <input type="hidden" name="match_id" value="{{ match.id }}">
                                            <input type="hidden" name="action" value="delete">
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this match?')">
                                                Delete
                                            </button>
                                        </form>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted mb-0">No matches created yet.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const teamSelects = document.querySelectorAll('.team-select');
    teamSelects.forEach(select => {
        select.addEventListener('change', function() {
            const matchId = this.dataset.matchId;
            const form = document.getElementById('form-' + matchId);
            form.submit();
        });
    });
});
</script>
{% endblock %} 